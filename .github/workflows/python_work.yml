name: Build Python
on:   
  push:
    branches:
    - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - name: Instalar dependências
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Executar testes
      run: pytest -v > resultado_teste.txt



    # - name: Job Finalizado
    #   run: echo "Finalizei"

    #  - name: Upload file
    #     uses: actions/upload-artifact@v4
    #     with:
    #       name: status
    #       path: status.txt


  # Roda SEMPRE (mesmo se pytest falhar)
    - name: Pós-teste (sempre)
      if: ${{ always() }}
      uses: actions/upload-artifact@v4
      with:
        name: resultad_testes
        path: resultado_teste.txt

    # Só roda se todos os steps anteriores passaram
    - name: Só em sucesso
      if: ${{ success() }}
      run: echo "✅ Todos os testes passaram! Workflow segue normalmente."

    # Só roda se o step de teste falhar
    - name: Só em falha
      if: ${{ failure() }}
      run: echo "❌ Um ou mais testes falharam. Encerrando execução do job."

